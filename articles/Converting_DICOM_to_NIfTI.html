<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Converting DICOMs to NIfTI Images • dcm2niir</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Converting DICOMs to NIfTI Images">
<meta property="og:description" content="dcm2niir">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dcm2niir</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Converting_DICOM_to_NIfTI.html">Converting DICOMs to NIfTI Images</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/muschellij2/dcm2niir/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Converting_DICOM_to_NIfTI_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Converting DICOMs to NIfTI Images</h1>
                        <h4 data-toc-skip class="author">John Muschelli</h4>
            
            <h4 data-toc-skip class="date">2021-05-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/muschellij2/dcm2niir/blob/master/vignettes/Converting_DICOM_to_NIfTI.Rmd" class="external-link"><code>vignettes/Converting_DICOM_to_NIfTI.Rmd</code></a></small>
      <div class="hidden name"><code>Converting_DICOM_to_NIfTI.Rmd</code></div>

    </div>

    
    
<p>The <code>dcm2niir</code> package creates simple wrapper for the ‘dcm2nii’ and ‘dcm2niix’ functions from Chris Rorden (<a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage" class="external-link uri">https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage</a>) for converting Digital Imaging and Communications in Medicine (DICOM) data to Neuroimaging Informatics Technology Initiative (NIfTI) formats.</p>
<div id="download-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#download-the-data" class="anchor" aria-hidden="true"></a>Download the data</h1>
<p>For use in this vignette, we will download some mouse enhanced magnetic resonance image (MRI). In the case below, we are downloading a T1-weighted pre-contrast image. The <code>dcm2niix</code> software can handle individual DICOM images (1 <code>dcm</code> file per slice) or combined/3D DICOM images (1 <code>dcm</code> per volume). Below, the example <code>dcm</code> is an entire series/volume.</p>
<p>We will create a temporary directory and download the <code>dcm</code> file to that directory. We do this because <code><a href="../reference/dcm2nii.html">dcm2niir::dcm2nii</a></code> takes in a folder/directory as the main argument <code>basedir</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">utils</span><span class="op">)</span>
<span class="co"># dcm_file = "ftp://medical.nema.org/medical/Dicom/DataSets/WG30/MGH/MR/MouseBrainSiemens15T_20150410/Converted/DICOM/mghmousetoenhancedmr_T1w_pre.dcm"</span>
<span class="va">dcm_file</span> <span class="op">=</span> <span class="st">"http://johnmuschelli.com/dcm2niir/mghmousetoenhancedmr_T1w_pre.dcm"</span>
<span class="va">tdir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tdir</span><span class="op">)</span>
<span class="va">destfile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".dcm"</span>, tmpdir <span class="op">=</span> <span class="va">tdir</span><span class="op">)</span>
<span class="va">ci</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CI"</span><span class="op">)</span>
<span class="va">method</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ci</span> <span class="op">==</span> <span class="st">""</span>, <span class="st">"auto"</span>, <span class="st">"curl"</span><span class="op">)</span>
<span class="va">dl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">dcm_file</span>, method <span class="op">=</span> <span class="va">method</span>, 
                   destfile <span class="op">=</span> <span class="va">destfile</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span>
<span class="va">dl</span> <span class="op">==</span> <span class="fl">0</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">destfile</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>We see a zero exit status and that the data exists. If this fails, you may not have <code>ftp</code> capabilities with R or your internet connection. Otherwise, this data may have moved, and please email the maintainer or submit an issue/bug report.</p>
</div>
<div id="loading-the-package" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-the-package" class="anchor" aria-hidden="true"></a>Loading the package</h1>
<p>We load the library here and run the <code>install_dcm2nii</code> function. This downloads the binaries of the <code>dcm2nii</code> and <code>dcm2niix</code> software to use at the command line. This only needs to be run once after the installation of <code>dcm2niir</code>. Most functions should check this before running, so this step is not completely necessary, but allows you to check if <code>dcm2niix</code> is installed, and if not, it will install the binary.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage" class="external-link">dcm2niir</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/install_dcm2nii.html">install_dcm2nii</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="convert-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#convert-the-data" class="anchor" aria-hidden="true"></a>Convert the data</h1>
<p>The main function is <code>dcm2nii</code>, and again the main argument is <code>basedir</code>. The argument <code>copy_files</code> indicates if the data from <code>basedir</code> should be copied to a temporary directory and <code>dcm2nii</code> will be run on that. This ensures nothing is done to the original data in case of a failure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">=</span> <span class="fu">dcm2niir</span><span class="fu">::</span><span class="fu"><a href="../reference/dcm2nii.html">dcm2nii</a></span><span class="op">(</span>basedir <span class="op">=</span> <span class="va">tdir</span><span class="op">)</span></code></pre></div>
<pre><code>## #Copying Files</code></pre>
<pre><code>## # Converting to nii</code></pre>
<pre><code>## '/home/runner/work/_temp/Library/dcm2niir/dcm2niix_linux' -9  -v 1 -z y -f %p_%t_%s '/tmp/RtmpOHvMwY/file8e1b31a2ae24'</code></pre>
<pre><code>## Warning in dcm2niir::dcm2nii(basedir = tdir): Result indicated an error! Please
## check results.</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span></code></pre></div>
<pre><code>## $result
## [1] 2
## 
## $nii_before
## character(0)
## 
## $nii_after
## character(0)
## 
## $json_after
## character(0)
## 
## $json_before
## character(0)
## 
## $cmd
## [1] "'/home/runner/work/_temp/Library/dcm2niir/dcm2niix_linux' -9  -v 1 -z y -f %p_%t_%s '/tmp/RtmpOHvMwY/file8e1b31a2ae24'"</code></pre>
<p>The command line results from <code>dcm2niix</code> should be printed out along with the command.</p>
<p>We see the resulting list consisting of the <code>result</code> (exit status of <code>dcm2niix</code> - 0 means success), <code>nii_before</code> (filenames of NIfTI files in the directory before running), <code>nii_after</code> (filenames of NIfTI files in the directory before running, these are the converted ones), and the <code>command</code> passed to <code>system</code> (in the <code>cmd</code> slot).</p>
<div id="manipulating-the-output" class="section level2">
<h2 class="hasAnchor">
<a href="#manipulating-the-output" class="anchor" aria-hidden="true"></a>Manipulating the output</h2>
<p>There is a quick wrapper function called <code>check_dcm2nii</code> that takes this output. If there are multiple outputs for the same sequence, which may happen with variable slice thicknesses in the sequence (CT or MRI), which is interpolated, or gantry tilt (CT), then <code>check_dcm2nii</code> will try to choose the correct one. Otherwise, it returns the <code>nii_after</code> element. Either way, it returns a character vector:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">checked</span> <span class="op">=</span> <span class="fu"><a href="../reference/check_dcm2nii.html">check_dcm2nii</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="va">checked</span></code></pre></div>
<pre><code>## character(0)
## attr(,"json_file")
## character(0)</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">checked</span><span class="op">)</span></code></pre></div>
<pre><code>## logical(0)</code></pre>
<p>Now this file can be read in using <code>neurobase::readnii</code>, <code>ortho2::readNIfTI</code>, <code>RNifti::readNifti</code>, or <code>ANTsR::antsImageRead</code> and be used as a 3D image.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Muschelli.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
